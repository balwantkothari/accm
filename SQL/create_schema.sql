DROP SCHEMA ACCOUNTS CASCADE;
CREATE SCHEMA ACCOUNTS;

DROP TABLE ACCOUNTS.CUSTOMER;
CREATE TABLE ACCOUNTS.CUSTOMER (
	CUST_ID INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1, INCREMENT BY 1) PRIMARY KEY,
	NAME VARCHAR(256) NOT NULL,
	PARENT_NAME VARCHAR(256) NOT NULL,
	VILLAGE VARCHAR(256) NOT NULL,
	ADDRESS VARCHAR(256) NOT NULL,
	PHONE INTEGER);

DROP TABLE ACCOUNTS.USERS;
CREATE TABLE ACCOUNTS.USERS (
	USER_ID INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1, INCREMENT BY 1) PRIMARY KEY,
	USERNAME VARCHAR(256) NOT NULL,
	PASSWORD VARCHAR(256) NOT NULL);
ALTER TABLE ACCOUNTS.USERS ADD CONSTRAINT USERNAME_UN UNIQUE (USERNAME);

DROP TABLE ACCOUNTS.LOAN;
CREATE TABLE ACCOUNTS.LOAN (
	LOAN_ID INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1, INCREMENT BY 1) PRIMARY KEY,
	CUST_ID INTEGER NOT NULL,
	LOAN_AMOUNT DOUBLE NOT NULL,
	LOAN_TYPE INTEGER NOT NULL,
	RATE FLOAT,
	ITEM VARCHAR(256),
	LOAN_DATE DATE NOT NULL,
	LOAN_STATUS INTEGER NOT NULL,
	COMMENT VARCHAR(1024),
	CONSTRAINT CUST_ID_FK FOREIGN KEY (CUST_ID) REFERENCES ACCOUNTS.CUSTOMER(CUST_ID),
	CONSTRAINT LOAN_AMOUNT_CHK CHECK (LOAN_AMOUNT > 0));

DROP TABLE ACCOUNTS.DEPOSITS;
CREATE TABLE ACCOUNTS.DEPOSITS(
	DEPOSIT_ID INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1, INCREMENT BY 1) PRIMARY KEY,
	LOAN_ID INTEGER NOT NULL,
	DEPOSIT_AMOUNT DOUBLE NOT NULL,
	DEPOSITS_BY VARCHAR(256),
	DEPOSITS_USER VARCHAR(256) NOT NULL,
	DEPOSIT_DATE DATE NOT NULL,
	CONSTRAINT LOAN_ID_FK FOREIGN KEY (LOAN_ID) REFERENCES ACCOUNTS.LOAN(LOAN_ID),
	CONSTRAINT DEPOSIT_AMOUNT_CHK CHECK (DEPOSIT_AMOUNT > 0));